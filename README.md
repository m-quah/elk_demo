## Description

This project uses Docker to set up a single-node ELK stack (ver. 8.x.x) with security enabled. Syslogs are streamed and indexed into Elasticsearch using Logstash. A demo Dashboard displaying various syslog details and a preconfigured rule/alert have also been set up in Kibana.


## Preparation of Environment

Before running `docker-compose`, ensure the following settings have been configured:
- Set up passwords for Elasticsearch, Kibana and Logstash in `.env` file
- Set the same password (in the `.env` file) for the '*elastic*' user in the '*/configfiles/logstash.conf*' file
- Set vm.max_map_count to at least 262144
  ``` bash
  sudo sysctl -w vm.max_map_count=262144
  ```
- Set up *rsyslog* to send messages to port 5000
  - Add the following line to the file *'/etc/rsyslog.d/50=default.conf'* so that all syslog messages are routed to port 5000
    - `*.*      @@127.0.0.1:5000`
  - Restart *rsyslog.service* to update the latest changes
    ``` bash 
    sudo systemctl restart rsyslog.service
    ```


## Set Up ELK Services with Docker

- Navigate to the directory containing the *docker-compose.yml* file. 
- Run the following command to start the various ELK services.
``` bash
docker-compose up --build
``` 

Once setup is completed, `stdout` will periodically update with the latest syslog log entry, which is also being added to the Elasticsearch index '***syslog***' (configured in the output in the file '*/configfiles/logstash.conf*').


## Kibana Login

Login to Kibana via `localhost:5601` in the web browser, with the username '*elastic*' and the password that was set up previously in the `.env` file.


## Kibana Dashboard

A ***Demo*** Dashboard and a **preconfigured rule/alert** have already been set up previously. To access them, import the *saved_object* that is found in '***./kibana_saved_objects/monitor_demo.ndjson***' into Kibana.
- **Management** -> **Stack Management** -> **Kibana** -> **Saved Objects**


## Kibana Rule/Alert

The preconfigured rule/alert '*saved_object*' should have been imported together with the dashboard settings in the previous step.

Enable the '***Monitor root sessions***' rule by navigating to:
- **Management** -> **Stack Management** -> **Alerts and Insights** -> **Rules and Connectors**

The rule detects the use of `sudo` in the host machine (which is captured by syslog message), and the kibana server log displays an *alert* log message at 1 minute intervals if the rule is triggered at any time in the preceding 1 minute.

To trigger the alert, enter any `sudo` command in the host machine terminal (eg. `sudo ls`). 

To view the *alert* log messages generated by the Kibana server, open a new terminal and tail the Kibana logs. 
``` bash
docker logs -f [kibana-container]
```

Within a minute, the Kibana server logs should have the following alert message displayed:
> Server log: !!! ALERT !!! 'SUDO' command used! -  [Timestamp]


## Tear Down ELK Services

- To tear down the services cleanly and remove all named volumes, run the command 
``` bash
docker-compose down -v
```